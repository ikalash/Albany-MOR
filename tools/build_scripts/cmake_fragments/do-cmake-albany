#! /bin/bash -xe

/bin/rm -f CMakeCache.txt

SOURCE_DIR=${ALBDIR:-..}

if [ ${ALBANY_PERIDIGM:-OFF} = "ON" ]
then
    ALBANY_PERIDIGM_ARGS="-D ENABLE_PERIDIGM:BOOL=ON \
                          -D PERIDIGM_DIR:STRING=${PERIDIGMDIR:?PERIDIGMDIR must be defined}"
fi

if [ ${ALBANY_CISM_INTERFACE:-OFF} = "ON" ]
then
    ALBANY_CISM_ARGS="-D ENABLE_CISM_INTERFACE:BOOL=ON \
                      -D CISM_INCLUDE_DIR:STRING=${CISMDIR:?CISMDIR must be defined}/include"
fi

if [ ${ALBANY_MPAS_INTERFACE:-OFF} = "ON" ]
then
    ALBANY_MPAS_ARGS="-D ENABLE_MPAS_INTERFACE:BOOL=ON \
                      -D MPAS_INCLUDE_DIR:STRING=${MPASDIR:?MPASDIR must be defined}/include"
fi

if [ ${ALBANY_LAME:-OFF} = "ON" ]
then
    ALBANY_LAME_ARGS="-D ENABLE_LAME:BOOL=ON \
                      -D LAME_INCLUDE_DIR:STRING=${LAMEDIR:?LAMEDIR must be defined}/include \
                      -D LAME_LIBRARY_DIR:STRING=$LAMEDIR/lib"
fi

if [ ${ALBANY_LAMENT:-OFF} = "ON" ]
then
    ALBANY_LAMENT_ARGS="-D ENABLE_LAMENT:BOOL=ON \
                        -D LAMENT_INCLUDE_DIR:STRING=${LAMENTDIR:?LAMENTDIR must be defined}/include \
                        -D LAMENT_LIBRARY_DIR:STRING=$LAMENTDIR/lib"
fi

if [ ${ALBANY_CI:-OFF} = "ON" ]
then
    ALBANY_CI_ARGS="-D ENABLE_ALBANY_CI:BOOL=ON \
                    -D ALBANY_CI_INCLUDE_DIR:STRING=${CIDIR:?CIDIR must be defined}/include \
                    -D ALBANY_CI_LIBRARY_DIR:STRING=$CIDIR/lib"
fi


cmake \
    -D ALBANY_TRILINOS_DIR:FILEPATH=${TRILINSTALLDIR:?TRILINSTALLDIR must be set} \
    -D CMAKE_BUILD_TYPE:STRING=$ALBANY_BUILD_MODE \
    -D CMAKE_VERBOSE_MAKEFILE:BOOL=${ALBANY_VERBOSE_MAKEFILE:-OFF} \
    -D ALBANY_CXX_FLAGS:STRING="$ALBANY_CXX_FLAGS" \
\
    -D ENABLE_LCM_TEST_EXES:BOOL=${ALBANY_DISABLE_LCM_TEST_EXES:-ON} \
    -D ENABLE_ALBANY_EPETRA_EXE:BOOL=${ALBANY_DISABLE_EPETRA_EXE:-ON} \
    -D ENABLE_SG:BOOL=${ALBANY_DISABLE_SG:-ON} \
    -D ENABLE_ENSEMBLE:BOOL=${ALBANY_DISABLE_ENSEMBLE:-ON} \
    -D ENABLE_MOR:BOOL=${ALBANY_DISABLE_MOR:-ON} \
    -D ENABLE_QCAD:BOOL=${ALBANY_DISABLE_QCAD:-ON} \
    -D ENABLE_DEMO_PDES:BOOL=${ALBANY_DISABLE_DEMO_PDES:-ON} \
\
    -D ENABLE_LCM:BOOL=${ALBANY_LCM:-OFF} \
    -D ENABLE_FELIX:BOOL=${ALBANY_FELIX:-OFF} \
    -D ENABLE_HYDRIDE:BOOL=${ALBANY_HYDRIDE:-OFF} \
    -D ENABLE_AMP:BOOL=${ALBANY_AMP:-OFF} \
    -D ENABLE_ATO:BOOL=${ALBANY_ATO:-OFF} \
    -D ENABLE_SCOREC:BOOL=${ALBANY_SCOREC:-OFF} \
    -D ENABLE_ASCR:BOOL=${ALBANY_ASCR:-OFF} \
    -D ENABLE_AERAS:BOOL=${ALBANY_AERAS:-OFF} \
    -D ENABLE_64BIT_INT:BOOL=${ALBANY_64BIT_INT:-OFF} \
    -D ENABLE_PERFORMANCE_TESTS:BOOL=${ALBANY_PERFORMANCE_TESTS:-OFF} \
    -D ENABLE_CATALYST:BOOL=${ALBANY_CATALYST:-OFF} \
    -D ENABLE_FAST_FELIX:BOOL=${ALBANY_FAST_FELIX:-OFF} \
    -D ENABLE_CHECK_FPE:BOOL=${ALBANY_CHECK_FPE:-OFF} \
    -D ENABLE_ALBANY_VERBOSE:BOOL=${ALBANY_VERBOSE:-OFF} \
    -D ENABLE_LCM_SPECULATIVE:BOOL=${ALBANY_LCM_SPECULATIVE:-OFF} \
    -D ENABLE_DEBUGGING:BOOL=${ALBANY_DEBUGGING:-OFF} \
    $ALBANY_PERIDIGM_ARGS \
    $ALBANY_CISM_ARGS \
    $ALBANY_MPAS_ARGS \
    $ALBANY_LAME_ARGS \
    $ALBANY_LAMENT_ARGS \
    $ALBANY_CI_ARGS \
    $SOURCE_DIR
